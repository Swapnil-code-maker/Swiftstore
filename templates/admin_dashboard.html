<!DOCTYPE html>
<html>
<head>
    <title>SwiftStore Admin</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            background: #f4f6fb;
            display: flex;
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            width: 260px;
            background: white;
            height: 100vh;
            padding: 30px 20px;
            position: fixed;
            border-right: 1px solid #e5e7eb;
        }

        .logo-container {
    text-align: center;
    margin-bottom: 30px;
}

.logo {
    width: 75px;
    display: block;
    margin: 0 auto 10px auto;
}

.brand-name {
    font-size: 18px;
    color: #6b7280;
    margin: 0;
    font-weight: 600;
}



        .sidebar a {
            display: block;
            padding: 12px 15px;
            color: #4b5563;
            text-decoration: none;
            border-radius: 10px;
            margin-bottom: 8px;
            font-weight: 500;
            transition: 0.3s;
        }

        .sidebar a:hover {
            background: linear-gradient(90deg, #a855f7, #6366f1);
            color: white;
        }

        .logout {
    margin-top: 30px;
    text-align: center;
}

.logout a {
    display: inline-block;
    padding: 8px 18px;
    font-size: 14px;
    background: #ef4444;
    color: white;
    text-decoration: none;
    border-radius: 6px;
    font-weight: 500;
    transition: 0.2s ease;
}

.logout a:hover {
    background: #dc2626;
    transform: translateY(-2px);
}


        /* ===== MAIN ===== */
        .main {
            margin-left: 280px;
            padding: 40px;
            width: 100%;
        }

        h1 {
            margin-bottom: 30px;
            color: #1f2937;
        }

        /* ===== STAT CARDS ===== */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            padding: 30px;
            border-radius: 16px;
            color: white;
        }

        .card1 { background: linear-gradient(135deg, #f97316, #f43f5e); }
        .card2 { background: linear-gradient(135deg, #3b82f6, #06b6d4); }
        .card3 { background: linear-gradient(135deg, #10b981, #14b8a6); }

        .stat-number {
            font-size: 28px;
            font-weight: bold;
            margin-top: 10px;
        }

        /* ===== SECTION CARDS ===== */
        .section {
            background: white;
            padding: 25px;
            border-radius: 16px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.05);
        }

        .section h2 {
            margin-bottom: 20px;
            color: #1f2937;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px;
            border-bottom: 1px solid #e5e7eb;
            text-align: left;
        }

        th {
            color: #6b7280;
            font-weight: 600;
        }

        tr:hover {
            background: #f9fafb;
        }

        button {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
        }

        .success { background: #22c55e; color: white; }
        .danger { background: #ef4444; color: white; }
        .warning { background: #f59e0b; color: white; }

        .complaint {
            padding: 15px;
            border-left: 4px solid #ef4444;
            background: #f9fafb;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .closed {
            border-left-color: #22c55e;
        }
        .id-modal {
    display: none;
    position: fixed;
    z-index: 999;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.6);
}

.id-modal-content {
    background: white;
    margin: 5% auto;
    padding: 25px;
    width: 60%;
    border-radius: 15px;
    position: relative;
}

.close-btn {
    position: absolute;
    right: 15px;
    top: 10px;
    font-size: 22px;
    cursor: pointer;
}


    </style>
</head>
<body>

<!-- SIDEBAR -->
<div class="sidebar">
    <div class="logo-container">
    <img src="https://image.similarpng.com/file/similarpng/very-thumbnail/2021/09/Online-shopping-logo-design-template-on-transparent-background-PNG.png"
         class="logo">
    <h2 class="brand-name">SwiftStore</h2>
</div>


    <a href="#dashboard">Dashboard</a>
    <a href="#analytics">Analytics</a>
    <a href="#deliveries">Delivery Partners</a>
    <a href="#vendors">Vendors</a>
    <a href="#customers">Customers</a>
    <a href="#orders">Orders</a>
    <a href="#complaints">Complaints</a>

    <div class="logout">
        <a href="/logout">Logout</a>
    </div>
</div>

<!-- MAIN -->
<div class="main">

<h1 id="dashboard">SwiftStore Admin Dashboard</h1>

<!-- STAT CARDS -->
<div class="stats">
    <div class="stat-card card1">
        Total Users
        <div class="stat-number">{{ total_users }}</div>
    </div>

    <div class="stat-card card2">
        Total Orders
        <div class="stat-number">{{ total_orders }}</div>
    </div>

    <div class="stat-card card3">
        Total Revenue
        <div class="stat-number">â‚¹ {{ total_revenue }}</div>
    </div>
</div>

<!-- REVENUE ANALYTICS -->
<div class="section">
    <h2>Revenue Analytics</h2>

    <div style="max-width:700px; height:300px;">
    <canvas id="revenueChart"></canvas>
</div>


    <!-- Revenue History Table -->
    <h3 style="margin-top:20px;">Revenue History</h3>

    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Revenue (â‚¹)</th>
            </tr>
        </thead>
        <tbody>
            {% if revenue_history %}
                {% for day in revenue_history %}
                <tr>
                    <td>{{ day.revenue_date.strftime('%d %b %Y') }}</td>
                    <td>â‚¹ {{ "%.2f"|format(day.total_amount) }}</td>
                </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="2" style="text-align:center; color:#9ca3af;">
                        No revenue data yet
                    </td>
                </tr>
            {% endif %}
        </tbody>
    </table>
</div>


<!-- DELIVERY PARTNERS -->
<div class="section" id="deliveries">
    <h2>Delivery Partners</h2>
    <table>
        <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Vehicle</th>
            <th>National ID</th>
            <th>Status</th>
        </tr>

        {% for d in delivery_partners %}
        <tr>
            <td>{{ d.full_name }}</td>
            <td>{{ d.email }}</td>
            <td>{{ d.vehicle_type }} ({{ d.vehicle_number }})</td>
            <td>
                {% if d.national_id %}
                   <button class="view-btn"
        onclick="openIdModal('{{ url_for('static', filename='uploads/' + d.national_id) }}')">
    View ID
</button>


                {% else %}
                    Not Uploaded
                {% endif %}
            </td>
            <<td>
    {% if d.is_verified %}
        <span style="color:#22c55e; font-weight:bold;">Verified</span>
    {% else %}
        <form action="{{ url_for('approve_delivery', user_id=d.id) }}" 
              method="POST" 
              style="display:inline;">
            <button type="submit" class="success">
                Approve
            </button>
        </form>
        <span style="color:#f59e0b; margin-left:8px;">Pending</span>
    {% endif %}
</td>

        </tr>
        {% endfor %}
    </table>
</div>


<!-- VENDORS -->
<div class="section" id="vendors">
    <h2>Vendors</h2>

    <table>
        <tr>
            <th>Company</th>
            <th>Email</th>
            <th>Pending Amount</th>
            <th>Action</th>
        </tr>

        {% for v in vendors %}
        <tr>
            <td>{{ v.company_name }}</td>
            <td>{{ v.email }}</td>

            <td>
                â‚¹ {{ "%.2f"|format(
                    (v.vendorledger_set
                     | selectattr("status", "equalto", "pending")
                     | map(attribute="net_amount")
                     | sum) if v.vendorledger_set else 0
                ) }}
            </td>

            <td>
                <form action="{{ url_for('settle_vendor', vendor_id=v.id) }}" method="POST">
                    <button class="success">
                        ðŸ’° Settle
                    </button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </table>
</div>



<!-- CUSTOMERS -->
<div class="section" id="customers">
    <h2>Customers</h2>
    <table>
        {% for c in customers %}
        <tr>
            <td>{{ c.email }}</td>
        </tr>
        {% endfor %}
    </table>
</div>

<!-- ORDERS -->
<div class="section" id="orders">
    <h2>Orders</h2>
    <table>
        {% for order in orders %}
        <tr>
            <td>#{{ order.id }}</td>
            <td>{{ order.status }}</td>
            <td>â‚¹ {{ order.total_price }}</td>
        </tr>
        {% endfor %}
    </table>
</div>

<!-- COMPLAINTS -->
<div class="section" id="complaints">
    <h2>Customer Complaints</h2>

    {% for complaint in complaints %}
    <div class="complaint {% if complaint.status == 'closed' %}closed{% endif %}">
        <strong>{{ complaint.customer.email }}</strong><br>

        {% if complaint.order %}
        Order: #{{ complaint.order.id }}<br>
        {% endif %}

        <p>{{ complaint.message }}</p>

        <small>{{ complaint.created_at.strftime('%d %b %Y %H:%M') }}</small><br>
        Status: {{ complaint.status }}

        {% if complaint.status == "open" %}
<a href="{{ url_for('reply_complaint', id=complaint.id) }}">
    <button class="warning">Reply & Close</button>
</a>
{% endif %}


    </div>
    {% endfor %}
</div>

</div>

<script>
const ctx = document.getElementById('revenueChart');

new Chart(ctx, {
    type: 'line',
    data: {
        labels: {{ revenue_dates|tojson }},
        datasets: [{
            label: 'Daily Revenue',
            data: {{ revenue_amounts|tojson }},
            borderColor: '#8b5cf6',
            backgroundColor: 'rgba(139,92,246,0.15)',
            tension: 0.4,
            fill: true
        }]
    },
    options: {
    responsive: true,
    maintainAspectRatio: false
}

});
</script>
<script>
function openIdModal(fileUrl) {
    document.getElementById("idModal").style.display = "block";
    document.getElementById("idFrame").src = fileUrl;
    document.getElementById("downloadBtn").href = fileUrl;
}

function closeIdModal() {
    document.getElementById("idModal").style.display = "none";
    document.getElementById("idFrame").src = "";
}
</script>

<!-- ID Preview Modal -->
<div id="idModal" class="id-modal">
    <div class="id-modal-content">
        <span class="close-btn" onclick="closeIdModal()">&times;</span>

        <h3>National ID Preview</h3>

        <iframe id="idFrame" src="" width="100%" height="400px"
                style="border-radius:10px;border:1px solid #ddd;">
        </iframe>

        <br><br>

        <a id="downloadBtn" href="" download>
            <button class="success">Download</button>
        </a>
    </div>
</div>


</body>
</html>
